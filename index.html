<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Normalizing Transformation Functions • bestNormalize</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Normalizing Transformation Functions">
<meta property="og:description" content="Estimate a suite of normalizing transformations, including 
    a new adaptation of a technique based on ranks which can guarantee 
    normally distributed transformed data if there are no ties: ordered 
    quantile normalization (ORQ). ORQ normalization combines a rank-mapping
    approach with a shifted logit approximation that allows
    the transformation to work on data outside the original domain. It is 
    also able to handle new data within the original domain via linear 
    interpolation. The package is built to estimate the best normalizing 
    transformation for a vector consistently and accurately. It implements 
    the Box-Cox transformation, the Yeo-Johnson transformation, three types 
    of Lambert WxF transformations, and the ordered quantile normalization 
    transformation. It estimates the normalization efficacy of other
    commonly used transformations, and it allows users to specify 
    custom transformations or normalization statistics. Finally, functionality
    can be integrated into a machine learning workflow via recipes. ">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">bestNormalize</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.8.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="articles/bestNormalize.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/customization.html">Customization within bestNormalize</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/petersonR/bestNormalize/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="bestnormalize-flexibly-calculate-the-best-normalizing-transformation-for-a-vector">bestNormalize: Flexibly calculate the best normalizing transformation for a vector<a class="anchor" aria-label="anchor" href="#bestnormalize-flexibly-calculate-the-best-normalizing-transformation-for-a-vector"></a>
</h1></div>

<p>The <code>bestNormalize</code> R package was designed to help find a normalizing transformation for a vector. There are many techniques that have been developed in this aim, however each has been subject to their own strengths/weaknesses, and it is unclear on how to decide which will work best until the data is observed. This package will look at a range of possible transformations and return the best one, i.e. the one that makes it look the <em>most</em> normal.</p>
<p>Note that some authors use the term “normalize” differently than in this package. We define “normalize”: to transform a vector of data in such a way that the transformed values follow a Gaussian distribution (or equivalently, a bell curve). This is in contrast to other such techniques designed to transform values to the 0-1 range, or to the -1 to 1 range.</p>
<p>This package also introduces a new adaptation of a normalization technique, which we call Ordered Quantile normalization (<code><a href="reference/orderNorm.html">orderNorm()</a></code>, or ORQ). ORQ transforms the data based off of a rank mapping to the normal distribution. This allows us to <em>guarantee</em> normally distributed transformed data (if ties are not present). The adaptation uses a shifted logit approximation on the ranks transformation to perform the transformation on newly observed data outside of the original domain. On new data within the original domain, the transformation uses linear interpolation of the fitted transformation.</p>
<p>To evaluate the efficacy of the normalization technique, the <code><a href="reference/bestNormalize.html">bestNormalize()</a></code> function implements repeated cross-validation to estimate the Pearson’s P statistic divided by its degrees of freedom. This is called the “Normality statistic”, and if it is close to 1 (or less), then the transformation can be thought of as working well. The function is designed to select the transformation that produces the lowest P / df value, when estimated on out-of-sample data (estimating this on in-sample data will always choose the orderNorm technique, and is generally not the main goal of these procedures).</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the most recent (devel) version of bestNormalize from GitHub with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"petersonR/bestNormalize"</span><span class="op">)</span></code></pre></div>
<p>Or, you can download it from CRAN with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"bestNormalize"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>In this example, we generate 1000 draws from a gamma distribution, and normalize them:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://petersonr.github.io/bestNormalize/" class="external-link">bestNormalize</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>

<span class="co"># Estimate best transformation with repeated cross-validation</span>
<span class="va">BN_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/bestNormalize.html">bestNormalize</a></span><span class="op">(</span><span class="va">x</span>, allow_lambert_s <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'lamW' was built under R version 4.0.5</span>
<span class="va">BN_obj</span>
<span class="co">#&gt; Best Normalizing transformation with 1000 Observations</span>
<span class="co">#&gt;  Estimated Normality Statistics (Pearson P / df, lower =&gt; more normal):</span>
<span class="co">#&gt;  - arcsinh(x): 3.6204</span>
<span class="co">#&gt;  - Box-Cox: 0.96</span>
<span class="co">#&gt;  - Center+scale: 6.7851</span>
<span class="co">#&gt;  - Exp(x): 50.8513</span>
<span class="co">#&gt;  - Lambert's W (type s): 1.0572</span>
<span class="co">#&gt;  - Log_b(x+a): 1.908</span>
<span class="co">#&gt;  - orderNorm (ORQ): 1.0516</span>
<span class="co">#&gt;  - sqrt(x + a): 1.4556</span>
<span class="co">#&gt;  - Yeo-Johnson: 1.7385</span>
<span class="co">#&gt; Estimation method: Out-of-sample via CV with 10 folds and 5 repeats</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Based off these, bestNormalize chose:</span>
<span class="co">#&gt; Standardized Box Cox Transformation with 1000 nonmissing obs.:</span>
<span class="co">#&gt;  Estimated statistics:</span>
<span class="co">#&gt;  - lambda = 0.2739638 </span>
<span class="co">#&gt;  - mean (before standardization) = -0.3870903 </span>
<span class="co">#&gt;  - sd (before standardization) = 1.045498</span>

<span class="co"># Perform transformation</span>
<span class="va">gx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">BN_obj</span><span class="op">)</span>

<span class="co"># Perform reverse transformation</span>
<span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">BN_obj</span>, newdata <span class="op">=</span> <span class="va">gx</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># Prove the transformation is 1:1</span>
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">x2</span>, <span class="va">x</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>As of version 1.3, the package supports leave-one-out cross-validation as well. ORQ normalization works very well when the size of the test dataset is low relative to the training data set, so it will often be selected via leave-one-out cross-validation (which is why we set <code>allow_orderNorm = FALSE</code> here).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">BN_loo</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/bestNormalize.html">bestNormalize</a></span><span class="op">(</span><span class="va">x</span>, allow_orderNorm <span class="op">=</span> <span class="cn">FALSE</span>, allow_lambert_s <span class="op">=</span> <span class="cn">TRUE</span>, loo <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Best Normalizing transformation with 1000 Observations</span>
<span class="co">#&gt;  Estimated Normality Statistics (Pearson P / df, lower =&gt; more normal):</span>
<span class="co">#&gt;  - arcsinh(x): 14.0712</span>
<span class="co">#&gt;  - Box-Cox: 0.8077</span>
<span class="co">#&gt;  - Center+scale: 26.5181</span>
<span class="co">#&gt;  - Exp(x): 451.435</span>
<span class="co">#&gt;  - Lambert's W (type s): 1.269</span>
<span class="co">#&gt;  - Log_b(x+a): 4.5374</span>
<span class="co">#&gt;  - sqrt(x + a): 3.3655</span>
<span class="co">#&gt;  - Yeo-Johnson: 5.7997</span>
<span class="co">#&gt; Estimation method: Out-of-sample via leave-one-out CV</span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Based off these, bestNormalize chose:</span>
<span class="co">#&gt; Standardized Box Cox Transformation with 1000 nonmissing obs.:</span>
<span class="co">#&gt;  Estimated statistics:</span>
<span class="co">#&gt;  - lambda = 0.2739638 </span>
<span class="co">#&gt;  - mean (before standardization) = -0.3870903 </span>
<span class="co">#&gt;  - sd (before standardization) = 1.045498</span></code></pre></div>
<p>It is also possible to visualize these transformations:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">BN_obj</span>, leg_loc <span class="op">=</span> <span class="st">"bottomright"</span><span class="op">)</span></code></pre></div>
<p>For a more in depth tutorial, please consult <a href="https://CRAN.R-project.org/package=bestNormalize/vignettes/bestNormalize.html" class="external-link">the package vignette</a>, or the <a href="https://petersonr.github.io/bestNormalize/" class="external-link">package website</a>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=bestNormalize" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/petersonR/bestNormalize/" class="external-link">Browse source code</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing bestNormalize</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Ryan Andrew Peterson <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-4650-5798" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=bestNormalize" class="external-link"><img src="https://www.r-pkg.org/badges/version/bestNormalize" alt="CRAN version"></a></li>
<li><a href="https://github.com/petersonR/bestNormalize/actions" class="external-link"><img src="https://github.com/petersonR/bestNormalize/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://cran.r-project.org/package=bestNormalize" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/bestNormalize" alt="downloads"></a></li>
<li><a href="https://app.codecov.io/gh/petersonR/bestNormalize?branch=master" class="external-link"><img src="https://codecov.io/gh/petersonR/bestNormalize/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Ryan Andrew Peterson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
